(function(){var e,t,n;e=1e3,t=e*15,$(function(){var e,t,r,i;return window.location.hostname==="net-engine.github.io"?e="http://net-engine.github.io/international-day-of-peace/assets":e="/assets",i={minZoom:2,noWrap:!0},window.map=L.mapbox.map("map","netengine.map-vfsy08ln",i).setView([27.75,9],2),r=$.getValues(""+e+"/javascripts/data/invasions-data.json"),window.decades=r.features,window.boundaries_data=$.getValues(""+e+"/javascripts/data/countries.geojson"),t=L.geoJson(boundaries_data,{style:function(e){return{color:"red",weight:1,fillOpacity:.1}},onEachFeature:n}),t.addTo(map),window.graph=Morris.Bar({element:"chart",barColors:["hsl(0,25%,10%)"],stacked:!0,data:[{y:"1940s",a:"0"}],xkey:"y",ykeys:["a"],labels:["Conflicts"],gridTextFamily:"Lora",gridTextColor:"hsl(0, 25%, 10%)"}),setTimeout(function(){return animation()},1500)}),jQuery.extend({getValues:function(e){var t;return t=null,$.ajax({url:e,type:"get",dataType:"json",async:!1,success:function(e){return t=e}}),t}}),window.toggleChart=function(e){var t;return t=$("#chart-box"),t.toggleClass("large"),setTimeout(function(){return t.find("svg").attr("height",t.height()).attr("width",t.width()),graph.redraw()},e)},n=function(e,t){return t.on({click:function(e){return e.target.setStyle({fillOpacity:.9,fillColor:"red",weight:2})}})},window.restart=function(){return window.location.reload()},window.animation=function(){var n,r;return r={color:"white",weight:2},n=0,window.graphData=[],$.eachStep(decades,t,function(i,s){var o;n++,o=s.invasions.length,typeof featureGroup!="undefined"&&featureGroup!==null&&map.removeLayer(featureGroup),window.featureGroup=L.featureGroup().addTo(map),$("#info").html("<div class='decade-title'>"+s.decade+"</div>"),$.eachStep(s.invasions,t/s.invasions.length,function(t,i){var u,a,f;return o--,graphData[n-1]={y:s.decade,a:s.occurrences},graph.setData(graphData),$("#invasion-info").html(JST["templates/invasion-info"](i)),a=i.coordinates,u=L.divIcon({className:"invasion",html:JST["templates/invasion"](i)}),window.marker=L.marker(a[0],{icon:u,riseOnHover:!0}).addTo(featureGroup),f=L.polyline(a,r).addTo(featureGroup),setTimeout(function(){return marker.setLatLng(a[1]),setTimeout(function(){return featureGroup.removeLayer(f),$(marker._icon).addClass("finished")},e*.75)},e/10)});if(n===decades.length)return setTimeout(function(){return toggleChart(300),$("#refresh").show()},t*2)})},$(document).on("click","#refresh",function(e){return restart(),$(this).hide()})}).call(this);