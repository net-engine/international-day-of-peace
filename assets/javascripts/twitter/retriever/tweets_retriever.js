(function(){this.TweetRetriever=function(){function e(e,t,n,r){t==null&&(t=null),this.timeBetweenQueries=n!=null?n:3e4,r==null&&(r=10),this.tc=new TwitterClient,this.queryParams={q:e,result_type:"recent",count:r},t&&(this.queryParams.geocode=t),this.cbOnLocatedTweet=this.cbForAnyTweet=null}return e.prototype.start=function(e,t){var n=this;return this.cbOnLocatedTweet=e,this.cbForAnyTweet=t,this.tc.afterInitialize(function(){return n.getTweets()})},e.prototype.getTweets=function(){var e=this;return this.tc.get(this.queryParams,function(t){return e.processTweets(t)})},e.prototype.processTweets=function(e){var t,n=this;return e.statuses&&(t=e.statuses.reverse()),_.each(t,function(e,t){var r;r=n.getTweetLocation(e),r&&n.cbOnLocatedTweet&&n.cbOnLocatedTweet(e,r[0],r[1]);if(n.cbForAnyTweet)return n.cbForAnyTweet(e)}),e.search_metadata&&e.search_metadata.refresh_url?(this.queryParams.since_id=e.search_metadata.max_id_str,setTimeout(function(){return n.getTweets()},this.timeBetweenQueries)):(typeof console!="undefined"&&console!==null&&console.log("limit reached, will try again in 5 minutes."),setTimeout(function(){return n.getTweets()},3e5))},e.prototype.getTweetLocation=function(e){var t,n,r,i;return r=i=0,e.geo&&e.geo.type==="Point"?(r=e.geo.coordinates[0],i=e.geo.coordinates[1]):e.location&&e.location.indexOf(": ")>0&&(n=e.location.split(": ")[1],r=n.split(",")[0]||0,i=n.split(",")[1]||0,!isNaN(parseFloat(r))&&!isNaN(parseFloat(i))&&(r=parseFloat(r),i=parseFloat(i))),t=null,r!==0&&i!==0&&(t=[r,i]),t},e}()}).call(this);